<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Receipt Scanner</title>
</head>
<body class="h-[100vh] flex flex-col justify-center items-center bg-black">

    <div class="w-auto h-auto bg-gray-700 text-white rounded-xl shadow-xl p-4 m-4">
        <p class="text-xl font-bold flex items-center flex-col">Receipt Scanner &lt;Test Interface&gt;</p>
        <p class="text-sm text-center text-gray-300">case sensitive</p>

        <div class="mt-4 flex items-center flex-row justify-between">
            <input class="border p-2" name="name" type="text" placeholder="Enter Name On Receipt"
            id="name"
            >


            <input class="ms-1 border p-2" type="text" placeholder="Enter Bank On Receipt"
            id="bank"
            >

            <!-- <select name="currency" id="currency" class="ml-4 p-2 rounded-lg bg-gray-600">
                
                <option selected value="--">Select Currency</option>
                <option value="â‚¦">â‚¦aira</option>
                <option value="$">$Dollar</option>
                <option value="Â£">Â£Pound</option>
                <option value="â‚¬">â‚¬Euro</option>
                <option value="â‚¹">â‚¹Rupee</option>
                <option value="â‚©">â‚©Won</option>
                <option value="Â¥">Â¥Yen</option>
                <option value="â‚º">â‚ºLira</option>
                <option value="â‚«">â‚«Dong</option>
                <option value="â‚±">â‚±Peso</option>
                <option value="â‚²">â‚²Guarani</option>
                <option value="â‚´">â‚´Hryvnia</option>
                <option value="â‚¦">â‚¦Naira</option>
                <option value="â‚¡">â‚¡Colon</option>
                <option value="â‚¸">â‚¸Tenge</option>
                <option value="â‚®">â‚®Tugrik</option>
                <option value="â‚¤">â‚¤Lira (old)</option>
                <option value="â‚³">â‚³Austral (old)</option>
                <option value="â‚°">â‚°Penny (old)</option>
                <option value="â‚¯">â‚¯Drachma (old)</option>
                <option value="â‚ ">â‚ Euro (old)</option>
                <option value="â‚£">â‚£Franc (old)</option>
                <option value="â‚¢">â‚¢Cruzeiro (old)</option>
                <option value="â‚¥">â‚¥Mill (old)</option>
                <option value="â‚§">â‚§Peseta (old)</option>
                <option value="â‚¨">â‚¨Rupee (old)</option>
                <option value="â‚³">â‚³Austral</option>
                <option value="â‚¤">â‚¤Lira</option>
                <option value="â‚°">â‚°Penny</option>
                <option value="â‚¯">â‚¯Drachma</option>
                <option value="â‚ ">â‚ Euro</option>
                <option value="â‚£">â‚£Franc</option>
                <option value="â‚¢">â‚¢Cruzeiro</option>
                <option value="â‚¥">â‚¥Mill</option>
            </select> -->
        </div>


        <div class="p-2 border shadow-xl mt-4 flex items-center flex-row">
            <input type="file" placeholder="Select a file"
            id="upload"
            accept="image/png, image/jpeg, image/jpg"
            >
            <i class="fa fa-upload"></i>
        </div>

        <p id="output" class="font-bold text-red-300"></p>
        <div id="result" class="mt-4">

        </div>


    </div>
    <!-- This receipt scanning tool is designed and developed by shokefunfemi@gmail.com ðŸ˜†ðŸ˜€ðŸ˜ƒ -->
    <div class="absolute top-0 text-gray-400 mt-4 p-1">
        <p class="font-bold text-lg">Read more about this project on 
            <a href="https://github.com/Loluwafemi/receipt-scanner" class="text-blue-400">
                <i class="fa fa-github" aria-hidden="true"></i>
                Github</a>
        </p>
    </div>
    <script>

            const name = document.querySelector("#name")
            const bank = document.querySelector("#bank")
            document.querySelector('#upload').setAttribute('disabled', true)

            name.addEventListener('input', (event)=> {

            if (event.target.value == '' || bank.value == '') {
                document.querySelector('#upload').setAttribute('disabled', true)
            }else {
                document.querySelector('#upload').setAttribute('disabled', false)
                document.querySelector('#upload').removeAttribute('disabled')
            }

            })

            bank.addEventListener('input', (event)=> {

            if (event.target.value == '' || name.value == '') {
                document.querySelector('#upload').setAttribute('disabled', true)
            }else {
                document.querySelector('#upload').setAttribute('disabled', false)
                document.querySelector('#upload').removeAttribute('disabled')
            }

            })
            


           document.querySelector('#upload').addEventListener('change', (event)=>{
            
            const file = event.target.files[0]
            const url = '{{baseURL}}extract_info'

            if (file) {
                // parst file to api
                const form = new FormData()
                form.append('file', file)
                form.append('name', name.value)
                form.append('bank', bank.value)
                
                fetch(url, {
                    method: "POST",
                    body: form
                }).then(async (response)=>{
                    if (!response.ok) {
                        document.querySelector("#output").innerHTML = "operation failed. try again"
                        return
                    }else{
                        // populate the space with output
                        const {name, amount, bank, date, status} = await response.json()

                        const statusMsg = status === true? "Succeful": "incomplete, parameter missing. Try again using correct api."        
                
                        document.querySelector("#result").innerHTML = `
                        <p class="text-md font-bold">Scanner Output</p>
                        <p>Status: <span id="status">${statusMsg}</span></p>

                            <div>
                                <span>Name: </span> <span>${name}</span>
                            </div>
                            <div>
                                <span>Bank: </span> <span>${bank}</span>
                            </div>
                            <div>
                                <span>Amount: </span> <span>${amount}</span>
                            </div>
                            <div>
                                <span>Date: </span> <span>${date}</span>
                            </div>

                        `
                        return
                    }


                })
            }else{
                document.querySelector("#output").innerHTML = "File Not Selected"
                return
            }


           })

    </script>
</body>
</html>